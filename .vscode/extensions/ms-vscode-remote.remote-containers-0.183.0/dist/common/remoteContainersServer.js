var Ft=Object.create,R=Object.defineProperty,Ht=Object.getPrototypeOf,me=Object.prototype.hasOwnProperty,Gt=Object.getOwnPropertyNames,Mt=Object.getOwnPropertyDescriptor,_e=Object.getOwnPropertySymbols,Yt=Object.prototype.propertyIsEnumerable;var Ee=(e,r,n)=>r in e?R(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,_=(e,r)=>{for(var n in r||(r={}))me.call(r,n)&&Ee(e,n,r[n]);if(_e)for(var n of _e(r))Yt.call(r,n)&&Ee(e,n,r[n]);return e},ke=e=>R(e,"__esModule",{value:!0});var c=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),Kt=(e,r)=>{for(var n in r)R(e,n,{get:r[n],enumerable:!0})},Wt=(e,r,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of Gt(r))!me.call(e,t)&&t!=="default"&&R(e,t,{get:()=>r[t],enumerable:!(n=Mt(r,t))||n.enumerable});return e},P=e=>Wt(ke(R(e!=null?Ft(Ht(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var ee=c((Li,Se)=>{Se.exports=function(r,n,t){r(n),t&&t(n===!0?null:n)}});var F=c((Ui,Be)=>{"use strict";var Pe=ee();Be.exports=function(r,n){if(!r)return function(u,i){return u?Pe(i,u,n):i(!0)};Array.isArray(r)||(r=Object.keys(r).map(function(u){return r[u]}));var t=0;return function(u,i){if(u)return Pe(i,u,n);t>=r.length?i(!0):i(null,r[t++])}}});var Ae=c((Di,Oe)=>{"use strict";var Qt=F();Oe.exports=function(e){return Qt(Object.keys(e))}});var re=c((Ji,Te)=>{"use strict";var $t=ee();Te.exports=function(r,n){return function(t,u){if(t)return $t(u,t,n);if(r!=null){var i=r;r=null,u(null,i)}else u(!0)}}});var Ne=c((Fi,Ce)=>{"use strict";Ce.exports=function(r){var n=0;return r=r||Infinity,function(t,u){if(t)return u&&u(t);if(n>r)return u(!0);u(null,n++)}}});var Re=c((Hi,Ie)=>{"use strict";Ie.exports=function(r){return r=r||Math.random,function(n,t){return n?t&&t(n):t(null,r())}}});var Ue=c((Gi,Le)=>{"use strict";Le.exports=function(){return function(r,n){n(!0)}}});var Je=c((Mi,De)=>{"use strict";De.exports=function(r){return function(n,t){t(r)}}});var He=c((Yi,Fe)=>{"use strict";Fe.exports={keys:Ae(),once:re(),values:F(),count:Ne(),infinite:Re(),empty:Ue(),error:Je()}});var O=c((Ki,Ge)=>{"use strict";Ge.exports=function(r,n){var t,u;function i(f){if(t=f,u)return i.abort();(function s(){for(var o=!0,l=!1;o;)if(l=!1,t(null,function(a,p){if(l=!0,a=a||u){if(o=!1,n)n(a===!0?null:a);else if(a&&a!==!0)throw a}else r&&r(p)===!1||u?(o=!1,t(u||!0,n||function(){})):o||s()}),!l){o=!1;return}})()}return i.abort=function(f,s){if(typeof f=="function"&&(s=f,f=!0),u=f||!0,t)return t(u,s||function(){})},i}});var Ye=c((Wi,Me)=>{"use strict";var zt=O();Me.exports=function(r){return zt(null,r)}});var We=c((Qi,Ke)=>{"use strict";var Vt=O();Ke.exports=function(r){return Vt(function(n){console.log(n)},r)}});var A=c(($i,Qe)=>{Qe.exports=function(r){return r&&(typeof r=="string"?function(n){return n[r]}:typeof r=="object"&&typeof r.exec=="function"?function(n){var t=r.exec(n);return t&&t[0]}:r)}});var Ve=c((zi,$e)=>{"use strict";function ze(e){return e}var Xt=A(),Zt=O();$e.exports=function(r,n){var t=!1;return n?r=Xt(r)||ze:(n=r,r=ze),Zt(function(u){if(r(u))return t=!0,n(null,u),!1},function(u){t||n(u===!0?null:u,null)})}});var H=c((Vi,Xe)=>{"use strict";var jt=O();Xe.exports=function(r,n,t){t||(t=n,n=null);var u=jt(function(i){n=r(n,i)},function(i){t(i,n)});return arguments.length===2?function(i){i(null,function(f,s){if(f)return t(f===!0?null:f);n=s,u(i)})}:u}});var je=c((Xi,Ze)=>{"use strict";var bt=H();Ze.exports=function(r){return bt(function(n,t){return n.push(t),n},[],r)}});var er=c((Zi,be)=>{"use strict";var eu=H();be.exports=function(r){return eu(function(n,t){return n+t},"",r)}});var nr=c((ji,rr)=>{"use strict";rr.exports={drain:O(),onEnd:Ye(),log:We(),find:Ve(),reduce:H(),collect:je(),concat:er()}});var ur=c((bi,tr)=>{"use strict";function ru(e){return e}var nu=A();tr.exports=function(r){return r?(r=nu(r),function(n){return function(t,u){n(t,function(i,f){try{f=i?null:r(f)}catch(s){return n(s,function(){return u(s)})}u(i,f)})}}):ru}});var or=c((eo,ir)=>{"use strict";function tu(e){return e}var uu=A();ir.exports=function(r){if(!r)return tu;r=uu(r);var n=!1,t,u;return function(i){return function f(s,o){if(u)return o(u);s?(u=s,n?i(s,function(l){n?t=o:o(s)}):i(s,function(l){o(s)})):i(null,function(l,a){l?o(l):u?o(u):(n=!0,r(a,function(p,h){n=!1,u?(o(u),t&&t(u)):p?f(p,o):o(null,h)}))})}}}});var ne=c((ro,sr)=>{var iu=A();function ou(e){return e}sr.exports=function(r){return typeof r=="object"&&typeof r.test=="function"?function(n){return r.test(n)}:iu(r)||ou}});var G=c((no,fr)=>{"use strict";var su=ne();fr.exports=function(r){return r=su(r),function(n){return function t(u,i){for(var f,s=!0;s;)s=!1,f=!0,n(u,function(o,l){if(!o&&!r(l))return f?s=!0:t(o,i);i(o,l)}),f=!1}}}});var cr=c((to,lr)=>{"use strict";var fu=ne(),lu=G();lr.exports=function(r){return r=fu(r),lu(function(n){return!r(n)})}});var pr=c((uo,ar)=>{"use strict";ar.exports=function(r,n){var t=!1;function u(i){t||!n||(t=!0,n(i===!0?null:i))}return function(i){return function(f,s){return f&&u(f),i(f,function(o,l){o?u(o):r&&r(l),s(o,l)})}}}});var dr=c((io,hr)=>{"use strict";hr.exports=function(r,n){n=n||{};var t=n.last||!1,u=!1;if(typeof r=="number"){t=!0;var i=r;r=function(){return--i}}return function(f){function s(o){f(!0,function(l){t=!1,o(l||!0)})}return function(o,l){u&&!o?t?s(l):l(u):(u=o)?f(u,l):f(null,function(a,p){(u=u||a)?l(u):r(p)?l(null,p):(u=!0,t?l(null,p):s(l))})}}}});var te=c((oo,vr)=>{"use strict";function cu(e){return e}var au=A(),pu=G();vr.exports=function(r,n){r=au(r)||cu;var t={};return pu(function(u){var i=r(u);return t[i]?!!n:(t[i]=!0,!n)})}});var yr=c((so,qr)=>{"use strict";var hu=te();qr.exports=function(r){return hu(r,!0)}});var gr=c((fo,xr)=>{"use strict";var du=F(),vu=re();xr.exports=function(){return function(r){var n;return function(t,u){t?n?n(t,function(s){r(s||t,u)}):r(t,u):n?i():f();function i(){n(null,function(s,o){s===!0?f():s?r(!0,function(l){u(s)}):u(null,o)})}function f(){n=null,r(null,function(s,o){if(s)return u(s);Array.isArray(o)||o&&typeof o=="object"?o=du(o):typeof o!="function"&&(o=vu(o)),n=o,i()})}}}}});var mr=c((lo,wr)=>{"use strict";wr.exports={map:ur(),asyncMap:or(),filter:G(),filterNot:cr(),through:pr(),take:dr(),unique:te(),nonUnique:yr(),flatten:gr()}});var ue=c((co,_r)=>{"use strict";_r.exports=function e(r){var n=arguments.length;if(typeof r=="function"&&r.length===1){for(var t=new Array(n),u=0;u<n;u++)t[u]=arguments[u];return function(s){if(t==null)throw new TypeError("partial sink should only be called once!");var o=t;switch(t=null,n){case 1:return e(s,o[0]);case 2:return e(s,o[0],o[1]);case 3:return e(s,o[0],o[1],o[2]);case 4:return e(s,o[0],o[1],o[2],o[3]);default:return o.unshift(s),e.apply(null,o)}}}var i=r;i&&typeof i.source=="function"&&(i=i.source);for(var u=1;u<n;u++){var f=arguments[u];typeof f=="function"?i=f(i):f&&typeof f=="object"&&(f.sink(i),i=f.source)}return i}});var M=c((E,Er)=>{"use strict";var kr=He(),Sr=nr(),Br=mr();E=Er.exports=ue();E.pull=E;for(var w in kr)E[w]=kr[w];for(var w in Br)E[w]=Br[w];for(var w in Sr)E[w]=Sr[w]});var ie=c((po,Pr)=>{var ao=Pr.exports=function(e){(function r(){var n=!0,t=!1,u=!1;do u=!0,n=!1,e.call(this,function(){u?n=!0:r()}),u=!1;while(n)})()}});var Ar=c((ho,Or)=>{var qu=ie();Or.exports=function(e,r){return function(n){var t=[],u,i;function f(l){t.push(l)}e=e||function(l){this.queue(l)},r=r||function(){this.queue(null)};var s={emit:function(l,a){l=="data"&&f(a),l=="end"&&(u=!0,f(null)),l=="error"&&(i=a)},queue:f},o;return function(l,a){if(u=u||l,l)return n(l,function(){if(o){var p=o;o=null,p(l)}a(l)});o=a,qu(function p(h){if(!!o)if(a=o,i)o=null,a(i);else if(t.length){var d=t.shift();o=null,a(d===null,d)}else n(u,function(v,g){if(v&&v!==!0)return i=v,h();if(u=u||v)r.call(s);else if(g!==null&&(e.call(s,g),i||u))return n(i||u,function(){o=null,a(i||u)});h(p)})})}}}});var Cr=c((vo,Tr)=>{Tr.exports=function(){var e=[],r=0;function n(){return e.reduce(function(t,u){return t+u.length},0)}return{length:r,data:this,add:function(t){if(!Buffer.isBuffer(t))throw new Error("data must be a buffer, was: "+JSON.stringify(t));return this.length=r=r+t.length,e.push(t),this},has:function(t){return t==null?r>0:r>=t},get:function(t){var u;if(t==null||t===r){r=0;var i=e;return e=[],i.length==1?i[0]:Buffer.concat(i)}else if(e.length>1&&t<=(u=e[0].length)){var f=e[0].slice(0,t);return t===u?e.shift():e[0]=e[0].slice(t,u),r-=t,f}else if(t<r){for(var s=[],o=0;o+e[0].length<t;){var l=e.shift();o+=l.length,s.push(l)}return o<t&&(s.push(e[0].slice(0,t-o)),e[0]=e[0].slice(t-o,e[0].length),this.length=r=r-t),Buffer.concat(s)}else throw new Error("could not get "+t+" bytes")}}}});var Lr=c((qo,Nr)=>{"use strict";var yu=Cr();function xu(e){return Number.isFinite(e)}function Ir(e){return typeof e=="function"}function Rr(e,r){return r?function(n,t){var u=setTimeout(function(){e(new Error("pull-reader: read exceeded timeout"),t)},r);e(n,function(i,f){clearTimeout(u),t(i,f)})}:e}Nr.exports=function(e){var r=[],n,t,u=!1,i=yu(),f,s,o;function l(){for(;r.length;)if(r[0].length==null&&i.has(1))r.shift().cb(null,i.get());else if(i.has(r[0].length)){var h=r.shift();h.cb(null,i.get(h.length))}else if(f==!0&&r[0].length&&i.length<r[0].length){var d="stream ended with:"+i.length+" but wanted:"+r[0].length;r.shift().cb(new Error(d))}else if(f)r.shift().cb(f);else return!!r.length;return r.length||!i.has(1)||o}function a(){var h=l();h&&!u&&n&&!u&&!s&&(u=!0,t(null,function(d,v){if(u=!1,d)return f=d,l();i.add(v),a()}))}function p(h){if(o){for(;r.length;)r.shift().cb(o);return cb&&cb(o)}t=Rr(h,e),n=h,a()}return p.abort=function(h,d){o=h||!0,n?(u=!0,n(o,function(){for(;r.length;)r.shift().cb(o);d&&d(o)})):d()},p.read=function(h,d,v){if(Ir(d)&&(v=d,d=e),Ir(v))r.push({length:xu(h)?h:null,cb:v}),a();else return s=!0,function(g,I){if(u||i.has(1)){if(g)return n(g,I);r.push({length:null,cb:I}),a()}else Rr(n,d)(g,function(Dt,Jt){I(Dt,Jt)})}},p}});var $r=c((k,Ur)=>{var gu=Ar(),wu=Lr(),Dr=0,Jr=1,Fr=2,Hr="GOODBYE",mu=Buffer.isBuffer;function Gr(e){return typeof e=="string"}function Mr(e){var r=Buffer.alloc(9),n=0,t=e.value!==void 0?e.value:e.end;return Gr(e)&&e===Hr?(r.fill(0),[r,null]):(Gr(t)?(n=Jr,t=Buffer.from(t,"utf-8")):mu(t)?n=Dr:(n=Fr,t=Buffer.from(JSON.stringify(t),"utf-8")),n=e.stream<<3|e.end<<2|n,r[0]=n,r.writeUInt32BE(t.length,1),r.writeInt32BE(e.req||0,5),[r,t])}function Yr(e){if(e.length!=9)throw new Error("expected header to be 9 bytes long");var r=e[0],n=e.readUInt32BE(1),t=e.readInt32BE(5);return{req:t,stream:!!(r&8),end:!!(r&4),value:null,length:n,type:r&3}}function Kr(e,r){if(e.length!==r.length)throw new Error("incorrect length, expected:"+r.length+" found:"+e.length);if(Dr===r.type)r.value=e;else if(Jr===r.type)r.value=e.toString();else if(Fr===r.type)r.value=JSON.parse(e.toString());else throw new Error("unknown message type");return r}function Wr(){return gu(function(e){var r=Mr(e);this.queue(r[0]),r[1]!==null&&this.queue(r[1])})}function Qr(){var e=wu(),r=!1;return function(n){return e(n),function(t,u){if(r)return u(!0);if(t)return e.abort(t,u);e.read(9,function(i,f){if(i)return u(i);var s=Yr(f);if(s.length===0)return r=!0,u(null,Hr);e.read(s.length,function(o,l){if(o)return u(o);try{Kr(l,s)}catch(a){return u(a)}u(null,s)})})}}}k=Ur.exports=function(e){return{source:Wr()(e.source),sink:function(r){return e.sink(Qr()(r))}}};k.encodePair=Mr;k.decodeHead=Yr;k.decodeBody=Kr;k.encode=Wr;k.decode=Qr});var Xr=c((yo,zr)=>{function L(e){return e&&(e===!0?!0:{message:e.message,name:e.name,stack:e.stack})}zr.exports=function(e){return new q(e)};function q(e){this.ended=!1,this.opts=e,this._req_counter=1,this._requests={},this._instreams={},this._outstreams={},this._closecbs=[],this._closing=!1,this._closed=!1,e.close&&this._closecbs.push(e.close)}q.prototype.message=function(e){this.read({req:0,stream:!1,end:!1,value:e})};q.prototype.request=function(e,r){if(this._closing)return r(new Error("parent stream is closing"));var n=this._req_counter++,t=this;this._requests[n]=function(u,i){delete t._requests[n],r(u,i),t._maybedone(u)},this.read({req:n,stream:!1,end:!1,value:e})};q.prototype.stream=function(){if(this._closing)throw new Error("parent stream is closing");var e=this._req_counter++,r=this;return this._outstreams[e]=new U(e,this,function(){delete r._outstreams[e]}),this._outstreams[e]};q.prototype.close=function(e){if(!e)throw new Error("packet-stream.close *must* have callback");if(this._closed)return e();this._closecbs.push(e),this._closing=!0,this._maybedone()};q.prototype.destroy=function(e){e=e||L(e),this.ended=e,this._closing=!0;var r=e===!0?new Error("unexpected end of parent stream"):e,n=0;for(var t in this._requests)n++,this._requests[t](r);for(var t in this._instreams)n++,this._instreams[t].writeEnd=!0,this._instreams[t].destroy(r);for(var t in this._outstreams)n++,this._outstreams[t].writeEnd=!0,this._outstreams[t].destroy(r);n===0&&e===!0&&(r=null),this._maybedone(r)};q.prototype._maybedone=function(e){this._closed||!this._closing||Object.keys(this._requests).length!==0||Object.keys(this._instreams).length!==0||Object.keys(this._outstreams).length!==0||(this._closed=!0,this._closecbs.forEach(function(r){r(e)}),this.read(null,e||!0),this.opts=null,this._closecbs.length=0,this.read=Vr)};function Vr(e){console.error("packet-stream asked to read after closed",e)}q.prototype.read=function(e){console.error("please overwrite read method to do IO",e)};q.prototype.write=function(e,r){this.ended||(r?this.destroy(r):e.req&&!e.stream?this._onrequest(e):e.req&&e.stream?this._onstream(e):this._onmessage(e))};q.prototype._onmessage=function(e){this.opts&&typeof this.opts.message=="function"&&this.opts.message(e.value)};q.prototype._onrequest=function(e){var r=e.req*-1;if(e.req<0)typeof this._requests[r]=="function"&&this._requests[r](e.end?e.value:null,e.end?null:e.value);else if(this.opts&&typeof this.opts.request=="function"){var n=!1,t=this;this.opts.request(e.value,function(i,f){if(n)throw new Error("cb called twice from local api");n=!0,i?t.read({value:L(i),end:!0,req:r}):t.read({value:f,end:!1,req:r}),t._maybedone()})}else{if(this.ended){var u=this.ended===!0?new Error("unexpected end of parent stream"):this.ended;this.read({value:L(u),end:!0,stream:!1,req:r})}else this.read({value:{message:"Unable to handle requests",name:"NO_REQUEST_HANDLER",stack:null},end:!0,stream:!1,req:r});this._maybedone()}};q.prototype._onstream=function(e){if(e.req<0){var r=e.req*-1,n=this._outstreams[r];if(!n)return console.error("no stream for incoming msg",e);e.end?(n.writeEnd&&delete this._outstreams[r],n.readEnd=!0,n.read(null,e.value),this._maybedone()):n.read(e.value)}else{var r=e.req,t=this._instreams[r];if(!t){var u=this;t=this._instreams[r]=new U(r*-1,this,function(){delete u._instreams[r]}),this.opts&&typeof this.opts.stream=="function"&&this.opts.stream(t)}e.end?(t.writeEnd&&delete this._instreams[r],t.readEnd=!0,t.read&&t.read(null,e.value),this._maybedone()):t.read?t.read(e.value):console.error("no .read for stream:",t.id,"dropped:",e)}};function U(e,r,n){this.id=e,this.read=null,this.writeEnd=null,this.readEnd=null,this._ps=r,this._remove=n,this._seq_counter=1}U.prototype.write=function(e,r){if(r){this.writeEnd=r;var n=this._ps;n&&(n.read({req:this.id,stream:!0,end:!0,value:L(r)}),this.readEnd&&this.destroy(r),n._maybedone(r))}else this._ps&&this._ps.read({req:this.id,stream:!0,end:!1,value:e})};U.prototype.end=function(e){this.write(null,L(e||!0))};U.prototype.destroy=function(e){if(this.writeEnd){if(!this.readEnd){this.readEnd=!0;try{this.read&&this.read(null,e)}catch(r){console.error("Exception thrown by PacketStream substream end handler",r),console.error(r.stack)}}}else{if(this.writeEnd=!0,!this.readEnd){this.readEnd=!0;try{this.read(null,e)}catch(r){console.error("Exception thrown by PacketStream substream end handler",r),console.error(r.stack)}}this.write(null,e)}this._ps&&(this._remove(),this._remove=null,this.read=Vr,this._ps=null)}});var jr=c((xo,S)=>{"use strict";var _u=M();function Eu(e){var r=!1;return function(n,t){r||(r=!0,e(n,t))}}S.exports=function(e,r){var n=[],t=!1,u,i,f=Eu(function(s,o){r&&r(s,o),e=null,r=null,u=null,i&&i(s||!0,function(){})});return e.read=function(s,o){if(t=t||o,u){var l=u;u=null,l(t,s)}else t||n.push(s);t&&f(t!==!0?t:null)},{source:function(s,o){s?(e&&e.write(null,s),o(s),f(s!==!0?s:null)):n.length?o(null,n.shift()):t?o(t):u=o},sink:function(s){if(t)return s(t,function(){}),i=null;i=s,_u.drain(function(o){if(t)return!1;e.write(o)},function(o){e&&!e.writeEnd&&e.write(null,o||!0),f&&f(o)})(s)}}};function Zr(e,r){return S.exports(e,function(n){e.writeEnd||e.write(null,n||!0),r&&r(n)})}S.exports.source=function(e){return Zr(e).source};S.exports.sink=function(e,r){return Zr(e,r).sink};S.exports.duplex=S.exports});var en=c((go,br)=>{br.exports=function(r){var n,t,u;function i(f){return function(s,o){f(s,function(l,a){if(l&&!u)return u=!0,o(null,r);l&&n?o(l):l?t=o:o(null,a)})}}return i.end=function(){return n=!0,t&&t(n),i},i}});var oe=c((wo,rn)=>{rn.exports=function(r,n,t){r(n),t&&t(n===!0?null:n)}});var Y=c((mo,nn)=>{"use strict";var tn=oe();nn.exports=function(r,n){if(!r)return function(u,i){return u?tn(i,u,n):i(!0)};Array.isArray(r)||(r=Object.keys(r).map(function(u){return r[u]}));var t=0;return function(u,i){if(u)return tn(i,u,n);t>=r.length?i(!0):i(null,r[t++])}}});var on=c((_o,un)=>{"use strict";var ku=Y();un.exports=function(e){return ku(Object.keys(e))}});var se=c((Eo,sn)=>{"use strict";var Su=oe();sn.exports=function(r,n){return function(t,u){if(t)return Su(u,t,n);if(r!=null){var i=r;r=null,u(null,i)}else u(!0)}}});var ln=c((ko,fn)=>{"use strict";fn.exports=function(r){var n=0;return r=r||Infinity,function(t,u){if(t)return u&&u(t);if(n>r)return u(!0);u(null,n++)}}});var an=c((So,cn)=>{"use strict";cn.exports=function(r){return r=r||Math.random,function(n,t){return n?t&&t(n):t(null,r())}}});var hn=c((Bo,pn)=>{"use strict";pn.exports=function(){return function(r,n){n(!0)}}});var vn=c((Po,dn)=>{"use strict";dn.exports=function(r){return function(n,t){t(r)}}});var yn=c((Oo,qn)=>{"use strict";qn.exports={keys:on(),once:se(),values:Y(),count:ln(),infinite:an(),empty:hn(),error:vn()}});var T=c((Ao,xn)=>{"use strict";xn.exports=function(r,n){var t,u;function i(f){if(t=f,u)return i.abort();(function s(){for(var o=!0,l=!1;o;)if(l=!1,t(null,function(a,p){if(l=!0,a=a||u){if(o=!1,n)n(a===!0?null:a);else if(a&&a!==!0)throw a}else r&&r(p)===!1||u?(o=!1,t(u||!0,n||function(){})):o||s()}),!l){o=!1;return}})()}return i.abort=function(f,s){if(typeof f=="function"&&(s=f,f=!0),u=f||!0,t)return t(u,s||function(){})},i}});var wn=c((To,gn)=>{"use strict";var Bu=T();gn.exports=function(r){return Bu(null,r)}});var _n=c((Co,mn)=>{"use strict";var Pu=T();mn.exports=function(r){return Pu(function(n){console.log(n)},r)}});var C=c((No,En)=>{En.exports=function(r){return r&&(typeof r=="string"?function(n){return n[r]}:typeof r=="object"&&typeof r.exec=="function"?function(n){var t=r.exec(n);return t&&t[0]}:r)}});var Bn=c((Io,kn)=>{"use strict";function Sn(e){return e}var Ou=C(),Au=T();kn.exports=function(r,n){var t=!1;return n?r=Ou(r)||Sn:(n=r,r=Sn),Au(function(u){if(r(u))return t=!0,n(null,u),!1},function(u){t||n(u===!0?null:u,null)})}});var K=c((Ro,Pn)=>{"use strict";var Tu=T();Pn.exports=function(r,n,t){t||(t=n,n=null);var u=Tu(function(i){n=r(n,i)},function(i){t(i,n)});return arguments.length===2?function(i){i(null,function(f,s){if(f)return t(f===!0?null:f);n=s,u(i)})}:u}});var An=c((Lo,On)=>{"use strict";var Cu=K();On.exports=function(r){return Cu(function(n,t){return n.push(t),n},[],r)}});var Cn=c((Uo,Tn)=>{"use strict";var Nu=K();Tn.exports=function(r){return Nu(function(n,t){return n+t},"",r)}});var In=c((Do,Nn)=>{"use strict";Nn.exports={drain:T(),onEnd:wn(),log:_n(),find:Bn(),reduce:K(),collect:An(),concat:Cn()}});var Ln=c((Jo,Rn)=>{"use strict";function Iu(e){return e}var Ru=C();Rn.exports=function(r){return r?(r=Ru(r),function(n){return function(t,u){n(t,function(i,f){try{f=i?null:r(f)}catch(s){return n(s,function(){return u(s)})}u(i,f)})}}):Iu}});var Dn=c((Fo,Un)=>{"use strict";function Lu(e){return e}var Uu=C();Un.exports=function(r){if(!r)return Lu;r=Uu(r);var n=!1,t,u;return function(i){return function f(s,o){if(u)return o(u);s?(u=s,n?i(s,function(){n?t=o:o(s)}):i(s,o)):i(null,function(l,a){l?o(l):u?o(u):(n=!0,r(a,function(p,h){n=!1,u?(o(u),t(u)):p?f(p,o):o(null,h)}))})}}}});var fe=c((Ho,Jn)=>{var Du=C();function Ju(e){return e}Jn.exports=function(r){return typeof r=="object"&&typeof r.test=="function"?function(n){return r.test(n)}:Du(r)||Ju}});var W=c((Go,Fn)=>{"use strict";var Fu=fe();Fn.exports=function(r){return r=Fu(r),function(n){return function t(u,i){for(var f,s=!0;s;)s=!1,f=!0,n(u,function(o,l){if(!o&&!r(l))return f?s=!0:t(o,i);i(o,l)}),f=!1}}}});var Gn=c((Mo,Hn)=>{"use strict";var Hu=fe(),Gu=W();Hn.exports=function(r){return r=Hu(r),Gu(function(n){return!r(n)})}});var Yn=c((Yo,Mn)=>{"use strict";Mn.exports=function(r,n){var t=!1;function u(i){t||!n||(t=!0,n(i===!0?null:i))}return function(i){return function(f,s){return f&&u(f),i(f,function(o,l){o?u(o):r&&r(l),s(o,l)})}}}});var Wn=c((Ko,Kn)=>{"use strict";Kn.exports=function(r,n){n=n||{};var t=n.last||!1,u=!1;if(typeof r=="number"){t=!0;var i=r;r=function(){return--i}}return function(f){function s(o){f(!0,function(l){t=!1,o(l||!0)})}return function(o,l){u?t?s(l):l(u):(u=o)?f(u,l):f(null,function(a,p){(u=u||a)?l(u):r(p)?l(null,p):(u=!0,t?l(null,p):s(l))})}}}});var le=c((Wo,Qn)=>{"use strict";function Mu(e){return e}var Yu=C(),Ku=W();Qn.exports=function(r,n){r=Yu(r)||Mu;var t={};return Ku(function(u){var i=r(u);return t[i]?!!n:(t[i]=!0,!n)})}});var zn=c((Qo,$n)=>{"use strict";var Wu=le();$n.exports=function(r){return Wu(r,!0)}});var Xn=c(($o,Vn)=>{"use strict";var Qu=Y(),$u=se();Vn.exports=function(){return function(r){var n;return function(t,u){t?n?n(t,function(s){r(s||t,u)}):r(t,u):n?i():f();function i(){n(null,function(s,o){s===!0?f():s?r(!0,function(l){u(s)}):u(null,o)})}function f(){n=null,r(null,function(s,o){if(s)return u(s);Array.isArray(o)||o&&typeof o=="object"?o=Qu(o):typeof o!="function"&&(o=$u(o)),n=o,i()})}}}}});var jn=c((zo,Zn)=>{"use strict";Zn.exports={map:Ln(),asyncMap:Dn(),filter:W(),filterNot:Gn(),through:Yn(),take:Wn(),unique:le(),nonUnique:zn(),flatten:Xn()}});var et=c((Vo,bn)=>{"use strict";bn.exports=function e(r){var n=arguments.length;if(typeof r=="function"&&r.length===1){for(var t=new Array(n),u=0;u<n;u++)t[u]=arguments[u];return function(s){if(t==null)throw new TypeError("partial sink should only be called once!");var o=t;switch(t=null,n){case 1:return e(s,o[0]);case 2:return e(s,o[0],o[1]);case 3:return e(s,o[0],o[1],o[2]);case 4:return e(s,o[0],o[1],o[2],o[3]);default:return o.unshift(s),e.apply(null,o)}}}var i=r;i&&typeof i.source=="function"&&(i=i.source);for(var u=1;u<n;u++){var f=arguments[u];typeof f=="function"?i=f(i):f&&typeof f=="object"&&(f.sink(i),i=f.source)}return i}});var it=c((D,rt)=>{"use strict";var nt=yn(),tt=In(),ut=jn();D=rt.exports=et();for(var m in nt)D[m]=nt[m];for(var m in ut)D[m]=ut[m];for(var m in tt)D[m]=tt[m]});var st=c((Xo,ot)=>{var zu=en(),ce=it();ot.exports=function(e,r){r=r||"GOODBYE";var n=zu(r);return{source:ce(e.source,n),sink:ce(ce.filter(function(t){if(t!==r)return!0;n.end()}),e.sink)}}});var J=c(y=>{"use strict";var Q=M();function Vu(e){return typeof e=="string"}function Xu(e){for(var r in e)return!1;return!0}y.set=function(e,r,n){for(var t,u,i=0;i<r.length;i++){var f=r[i];e[f]=e[f]||{},t=e,u=f,e=e[f]}t[u]=n};y.get=function(e,r){if(Vu(r))return e[r];for(var n,t=0;t<r.length;t++){var u=r[t];if(n=e=e[u],e==null)return e}return n};y.prefix=function(e,r){for(var n,t=0;t<r.length;t++){var u=r[t];if(n=e=e[u],typeof e!="object")return e}return typeof n!="object"?!!n:!1};function Zu(e,r){for(var n in r){var t=r[n];e[t]||(e[t]={}),e=e[t]}return e}function ju(e,r){(function n(t,u){var i=r[u];if(t)r.length-1===u?delete t[i]:u<r.length&&n(t[i],u+1);else return;Xu(t[i])&&delete t[i]})(e,0)}function bu(e,r){for(var n in r)e[n]=r[n];return e}y.mount=function(e,r,n){if(!Array.isArray(r))throw new Error("path must be array of strings");return bu(Zu(e,r),n)};y.unmount=function(e,r){return ju(e,r)};function ae(e){return e==="source"}function pe(e){return e==="sink"}function ei(e){return e==="duplex"}function ri(e){return e==="sync"}function ni(e){return e==="async"}function ti(e){return ri(e)||ni(e)}function he(e){return function(r){r(e||!0,function(){})}}function ft(e){return{source:Q.error(e),sink:he(e)}}y.errorAsStream=function(e,r){return ae(e)?Q.error(r):pe(e)?he(r):ft(r)};y.errorAsStreamOrCb=function(e,r,n){return ti(e)?n(r):ae(e)?Q.error(r):pe(e)?he(r):n(r),ft(r)};y.pipeToStream=function(e,r,n){ae(e)?r(n):pe(e)?n(r):ei(e)&&Q(r,n,r)}});var de=c((bo,lt)=>{function ct(e){if(e.stack&&e.name&&e.message)return e.stack.substring(e.name.length+3+e.message.length).split(`
`);if(e.stack)return e.stack.split(`
`)}function ui(e,r){return e.filter(function(n){return!~r.indexOf(n)})}var jo=lt.exports=function(e,r){if(!(e.stack&&e.name&&e.message))return console.error(new Error("stackless error")),e;var n=new Error(r),t=ui(ct(n).slice(1),ct(e)).join(`
`);return n.__proto__=e,n.stack=n.name+": "+n.message+`
`+t+`
  `+e.stack,n}});var qt=c((es,at)=>{"use strict";var ii=Xr(),ve=jr(),oi=st(),pt=J(),ht=de();function si(e){return typeof e=="function"}function fi(e){return e==="source"}function li(e){return e==="sink"}function ci(e){return e==="duplex"}function ai(e){return e==="sync"}function pi(e){return e==="async"}function dt(e){return ai(e)||pi(e)}function vt(e){return fi(e)||li(e)||ci(e)}at.exports=function(r,n,t){var u=ii({message:function(){},request:function(f,s){if(!Array.isArray(f.args))return s(new Error("invalid request, args should be array, was:"+JSON.stringify(f)));var o=f.name,l=f.args,a=!1,p=!1;l.push(function(h,d){p=!0,a=!0,s(h,d)});try{r("async",o,l)}catch(h){if(a||p)throw ht(h,"no callback provided to muxrpc async funtion");return s(h)}},stream:function(f){f.read=function(s,o){if(o)return f.write(null,o);var l=s.name,a=s.type,p,h;if(f.read=null,!vt(a))return f.write(null,new Error("unsupported stream type:"+a));try{h=r(a,l,s.args)}catch(v){p=v}var d=ve[{source:"sink",sink:"source"}[a]||"duplex"](f);return pt.pipeToStream(a,d,p?pt.errorAsStream(a,p):h)}},close:function(f){if(u=null,i.ended=!0,!i.closed&&(i.closed=!0,t)){var s=t;t=null,s(f)}}}),i=oi(ve(u,function(){}));return i=n?n(i):i,i.remoteCall=function(f,s,o,l){if(s==="emit")return u.message(o);if(!(dt(f)||vt(f)))throw new Error("unsupported type:"+JSON.stringify(f));if(dt(f))return u.request({name:s,args:o},l);var a=u.stream(),p=ve[f](a,l);return a.write({name:s,args:o,type:f}),p},i.isOpen=function(){return!u.ended},i.close=function(f,s){return si(f)&&(s=f,f=!1),u?f?(u.destroy(f),s&&s()):(u.close(function(o){if(s)s(o);else if(o)throw ht(o,"no callback provided for muxrpc close")}),this):s&&s()},i.closed=!1,i}});var xt=c((rs,yt)=>{"use strict";var hi=J(),di=de();function vi(e){return typeof e=="function"}function qi(e){return e&&typeof e=="object"}function qe(e,r,n,t){for(var u in r)(function(i,f){var s=n?n.concat(i):[i];e[i]=qi(f)?qe({},f,s,t):function(){return t(f,s,[].slice.call(arguments))}})(u,r[u]);return e}function yi(e){if(e)throw di(e,"callback not provided")}var xi=["sync","async"];yt.exports=function(e,r,n,t){e=e||{};function u(i,f,s){var o=vi(s[s.length-1])?s.pop():xi.includes(i)?null:yi,l;if(typeof o=="function"){try{l=n(i,f,s,o)}catch(a){return hi.errorAsStreamOrCb(i,a,o)}return l}else return new Promise((a,p)=>n(i,f,s,(h,d)=>{h?p(h):a(d)}))}return t?u("async","manifest",[function(i,f){if(i)return t(i);qe(e,f,null,u),t(null,f,e)}]):qe(e,r,null,u),e}});var _t=c((ns,gt)=>{"use strict";var $=J(),wt=Array.isArray;function z(e){return typeof e=="function"}function mt(e){return wt(e)?e:e.split(".")}function gi(e){return e&&z(e.pre)&&z(e.test)&&z(e.post)}gt.exports=function(e){if(gi(e))return e;if(z(e))return{pre:e};var r=null,n={};function t(u){return u.allow?(r={},u.allow.forEach(function(i){$.set(r,mt(i),!0)})):r=null,u.deny?u.deny.forEach(function(i){$.set(n,mt(i),!0)}):n={},this}return e&&t(e),t.pre=function(u){if(u=wt(u)?u:[u],r&&!$.prefix(r,u))return new Error("method:"+u+" is not in list of allowed methods");if(n&&$.prefix(n,u))return new Error("method:"+u+" is on list of disallowed methods")},t.post=function(){},t.test=function(u){return t.pre(u)},t.get=function(){return{allow:r,deny:n}},t}});var kt=c((ts,Et)=>{var wi=_t(),ye=J();Et.exports=function(r,n,t){t=wi(t);function u(f,s){return f===ye.get(n,s)}function i(f,s,o){if(s==="emit")throw new Error("emit has been removed");if(f==="async"&&u("sync",s)){var l=o.pop(),a;try{a=ye.get(r,s).apply(this,o)}catch(p){return l(p)}return l(null,a)}if(!u(f,s))throw new Error("no "+f+":"+s);return ye.get(r,s).apply(this,o)}return function(f,s,o){var l=t.pre(s,o);if(l)throw l;return i.call(this,f,s,o)}}});var Pt=c((us,St)=>{"use strict";var mi=$r(),_i=qt(),Ei=xt(),ki=kt(),Si=require("events").EventEmitter;function Bt(e,r,n,t,u,i,f){var s;typeof e=="function"&&(s=e,e={}),r=r||{},e=e||{};var o=new Si;i||(i=mi);var l,a={_emit:function(d,v){return o&&o._emit(d,v),a},id:t},p=_i(ki(n,r,u).bind(a),i,function(d){if(!o.closed&&(o.closed=!0,o.emit("closed"),l)){var v=l;l=null,v(d)}});if(Ei(o,e,function(d,v,g,I){if(p.closed)throw new Error("stream is closed");return p.remoteCall(d,v,g,I)},s),o._emit=o.emit,f){Object.__defineGetter__.call(o,"id",function(){return a.id}),Object.__defineSetter__.call(o,"id",function(d){a.id=d});var h=!0;o.createStream=function(d){if(l=d,h)return h=!1,p;throw new Error("one stream per rpc")}}else o.stream=p;return o.closed=!1,o.close=function(d,v){return p.close(d,v),this},o}St.exports=function(e,r,n){return arguments.length>3?Bt.apply(this,arguments):function(t,u,i){return Bt(e,r,t,i,u,n,!0)}}});var Ct=c((x,Ot)=>{var is=ue(),Bi=ie();function At(e){e.destroy?e.destroy():console.error("warning, stream-to-pull-stream: \nthe wrapped node-stream does not implement `destroy`, \nthis may cause resource leaks.")}function Tt(e,r,n){var t,u=!1,i;function f(){i||(i=!0,n&&n(t===!0?null:t))}function s(){u||(u=!0,l(),t?f():e(t=!0,f))}function o(a){l(),t||e(t=a,f)}function l(){r.on("finish",s),r.removeListener("close",s),r.removeListener("error",o)}r.on("close",s),r.on("finish",s),r.on("error",o),process.nextTick(function(){Bi(function(a){e(null,function(p,h){if(t=t||p,p===!0)return r._isStdio?f():r.end();if(t=t||p)return At(r),f(t);if(r._isStdio)r.write(h,function(){a()});else{var d=r.write(h);d===!1?r.once("drain",a):a()}})})})}function Pi(e){var r=!1,n=!1,t;function u(){var i=e.read();if(i!==null&&t){var f=t;t=null,f(null,i)}}return e.on("readable",function(){n=!0,t&&u()}).on("end",function(){r=!0,t&&t(r)}).on("error",function(i){r=i,t&&t(r)}),function(i,f){t=f,r?f(r):n&&u()}}function V(e){var r=[],n=[],t,u=!1,i;function f(){for(;(r.length||t)&&n.length;)n.shift()(r.length?null:t,r.shift());!r.length&&u&&(u=!1,e.resume())}return e.on("data",function(s){r.push(s),f(),r.length&&e.pause&&(u=!0,e.pause())}),e.on("end",function(){t=!0,f()}),e.on("close",function(){t=!0,f()}),e.on("error",function(s){t=s,f()}),function(s,o){if(!o)throw new Error("*must* provide cb");if(s){let a=function(){for(;n.length;)n.shift()(s);o(s)};var l=a;if(t)return a();e.once("close",a),At(e)}else n.push(o),f()}}var Oi=V,X=function(e,r){return function(n){return Tt(n,e,r)}},Z=function(e){return V(e)};x=Ot.exports=function(e,r){return e.writable&&e.write?e.readable?function(n){return Tt(n,e,r),V(e)}:X(e,r):Z(e)};x.sink=X;x.source=Z;x.read=Oi;x.read1=V;x.read2=Pi;x.duplex=function(e,r){return{source:Z(e),sink:X(e,r)}};x.transform=function(e){return function(r){var n=Z(e);return X(e)(r),n}}});ke(exports);Kt(exports,{logThrough:()=>Ii});var Nt=P(require("net")),It=P(require("http")),j=P(require("fs")),xe=P(require("child_process")),ge=P(M()),we=P(require("util")),Ai=Pt(),N=Ct(),Rt=JSON.parse(process.env.REMOTE_CONTAINERS_SOCKETS),Ti=_(_({},Rt.reduce((e,r)=>(e[r]="duplex",e),{})),{rpc:"async",ready:"async"}),Ci={exec:"async",stdin:"sink",stdout:"source",stderr:"source",exit:"async",terminate:"async",dispose:"async",execToEnd:"async"},B={},Ni=0,b=Ai(Ti,Ci)({exec:(e,r)=>{let n=e.cwd,t=e.env?_(_({},process.env),e.env):process.env,u=xe.spawn(e.cmd,e.args,{cwd:n,env:t,windowsHide:!0}),i=Ni++;B[i]={process:u,exit:new Promise((f,s)=>{u.once("error",s),u.once("close",(o,l)=>{f({code:o,signal:l})})}),stdin:N.sink(u.stdin),stdout:N.source(u.stdout),stderr:N.source(u.stderr)},r(null,i)},stdin:e=>B[e].stdin,stdout:e=>B[e].stdout,stderr:e=>B[e].stderr,exit:(e,r)=>{B[e].exit.then(n=>r(null,n),r)},terminate:(e,r)=>{B[e].process.kill("SIGKILL"),r()},dispose:(e,r)=>{delete B[e],r()},execToEnd:(e,r)=>{let n=e.cwd,t=e.env?_(_({},process.env),e.env):process.env,u=xe.spawn(e.cmd,e.args,{cwd:n,env:t,windowsHide:!0}),i=[];u.stdout.on("data",s=>i.push(s));let f=[];u.stderr.on("data",s=>f.push(s)),u.once("error",r),u.once("close",(s,o)=>{r(null,{stdout:Buffer.concat(i),stderr:Buffer.concat(f),code:s,signal:o})})}});(0,ge.default)(N.source(process.stdin),b.createStream(),N.sink(process.stdout));function Ii(e){return function(n,t){e(n,function(u,i){console.error(`logThrough: ${i==null?void 0:i.toString()}`),t(u,i)})}}var Lt=Rt.map(async e=>{try{if(!(await(0,we.promisify)(j.lstat)(e)).isSocket())return;await(0,we.promisify)(j.unlink)(e)}catch(n){if(!(n&&n.code==="ENOENT"))throw n}let r=Nt.createServer(n=>{n=N.duplex(n),(0,ge.default)(n,b[e](t=>{t&&console.error("Remote to local stream terminated with error:",t)}),n)});return new Promise(n=>r.listen(e,n))}),Ut;Lt.push(new Promise(e=>Ut=e));It.createServer((e,r)=>{let n=[];e.on("data",t=>n.push(t)),e.on("end",()=>{b.rpc(Buffer.concat(n).toString(),(t,u)=>{t?(console.error(t),r.writeHead(500),r.end()):(r.writeHead(200),r.write(u,i=>{i&&console.error(i)}),r.end())})})}).listen(process.env.REMOTE_CONTAINERS_IPC,Ut);Promise.all(Lt).then(()=>b.ready(e=>{e&&console.error(e)})).catch(e=>console.error(e));0&&(module.exports={logThrough});
//# sourceMappingURL=remoteContainersServer.js.map
